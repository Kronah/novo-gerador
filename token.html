<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8" />
  <title>Tokens Ativos - BossDV</title>
  <style>
    body {
      background: #121212;
      color: #eee;
      font-family: 'Segoe UI', sans-serif;
      padding: 20px;
    }
    h1 {
      color: #4caf50;
    }
    table {
      width: 100%;
      border-collapse: collapse;
      margin-top: 20px;
    }
    th, td {
      padding: 10px;
      border-bottom: 1px solid #444;
      text-align: left;
    }
    th {
      background-color: #1e1e1e;
    }
    tr:hover {
      background-color: #222;
    }
  </style>
</head>
<body>

  <h1>Tokens Ativos</h1>
  <button onclick="window.location.href='index.html'">Voltar</button>

  <table id="tokensTable">
    <thead>
      <tr>
        <th>Nome</th>
        <th>Expira em</th>
        <th>Token</th>
      </tr>
    </thead>
    <tbody></tbody>
  </table>

  <script>
    // Verifica se veio autenticado
    const auth = localStorage.getItem("auth");
    if (auth !== "true") window.location.href = "login.html";

   const firebaseBase = "https://bossdv-72d16-default-rtdb.firebaseio.com/tokens ";

async function carregarTokens() {
  const tbody = document.querySelector("#tokensTable tbody");

  try {
    const resposta = await fetch(firebaseBase + ".json"); // Adicionamos .json aqui
    const dados = await resposta.json();

    console.log("Dados recebidos:", dados);

    if (!dados || Object.keys(dados).length === 0) {
      tbody.innerHTML = "<tr><td colspan='3'>Nenhum token encontrado.</td></tr>";
      return;
    }

    let tokensAtivos = false;

    for (let token in dados) {
      const item = dados[token];

      if (
        item &&
        item.valid === true &&
        item.expire_at &&
        new Date(item.expire_at) > new Date()
      ) {
        tokensAtivos = true;

        const linha = document.createElement("tr");
        linha.innerHTML = `
          <td>${item.nome}</td>
          <td>${item.expire_at}</td>
          <td><small>${token}</small></td>
        `;
        tbody.appendChild(linha);
      }
    }

    if (!tokensAtivos) {
      tbody.innerHTML = "<tr><td colspan='3'>Nenhum token ativo encontrado.</td></tr>";
    }

  } catch (e) {
    console.error("Erro ao carregar tokens:", e);
    tbody.innerHTML = "<tr><td colspan='3'>Erro ao carregar tokens.</td></tr>";
  }
}
    window.onload = carregarTokens;
  </script>

</body>
</html>
